<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2048</title>
  <style>
    body { background:#000; color:#fff; text-align:center; font-family:Arial; }
    #game { 
      width:400px; height:400px; margin:20px auto; 
      display:grid; grid-template:repeat(4,1fr)/repeat(4,1fr); 
      gap:5px; background:#222; padding:5px;
    }
    .cell {
      background:#333; font-size:2em; font-weight:bold;
      display:flex; align-items:center; justify-content:center;
    }
  </style>
</head>
<body>
  <h1>2048</h1>
  <div id="game"></div>
  <script>
    const size = 4;
    let board = [];

    function init() {
      board = Array(size).fill().map(()=>Array(size).fill(0));
      addTile(); addTile();
      draw();
    }

    function addTile() {
      let empty = [];
      for (let r=0;r<size;r++) {
        for (let c=0;c<size;c++) {
          if (board[r][c]===0) empty.push({r,c});
        }
      }
      if (empty.length) {
        let {r,c} = empty[Math.floor(Math.random()*empty.length)];
        board[r][c] = Math.random()<0.9?2:4;
      }
    }

    function slide(row) {
      row = row.filter(v=>v);
      for (let i=0;i<row.length-1;i++) {
        if (row[i]===row[i+1]) {
          row[i]*=2;
          row[i+1]=0;
        }
      }
      row = row.filter(v=>v);
      while(row.length<size) row.push(0);
      return row;
    }

    function rotate(matrix) {
      return matrix[0].map((_,i)=>matrix.map(row=>row[i]).reverse());
    }

    function move(dir) {
      let rotated = false;
      let played = false;
      if (dir==="left") {
        for (let r=0;r<size;r++) {
          let newRow = slide(board[r]);
          if (newRow.toString()!==board[r].toString()) played=true;
          board[r]=newRow;
        }
      } else if (dir==="right") {
        for (let r=0;r<size;r++) {
          board[r].reverse();
          let newRow = slide(board[r]);
          board[r]=newRow.reverse();
        }
        played=true;
      } else if (dir==="up"||dir==="down") {
        for (let i=0;i<(dir==="up"?1:3);i++) board=rotate(board);
        for (let r=0;r<size;r++) board[r]=slide(board[r]);
        for (let i=0;i<(dir==="up"?3:1);i++) board=rotate(board);
        played=true;
      }
      if (played) addTile();
      draw();
    }

    function draw() {
      const game=document.getElementById("game");
      game.innerHTML="";
      for (let r=0;r<size;r++) {
        for (let c=0;c<size;c++) {
          let cell=document.createElement("div");
          cell.className="cell";
          cell.textContent=board[r][c]||"";
          cell.style.background=board[r][c]?"#"+(Math.log2(board[r][c])*222):"#333";
          game.appendChild(cell);
        }
      }
    }

    document.addEventListener("keydown",e=>{
      if(e.key==="ArrowLeft") move("left");
      else if(e.key==="ArrowRight") move("right");
      else if(e.key==="ArrowUp") move("up");
      else if(e.key==="ArrowDown") move("down");
    });

    init();
  </script>
</body>
</html>
